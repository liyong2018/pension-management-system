<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>服务记录模块测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .pending { background-color: #d1ecf1; color: #0c5460; }
        button { margin: 5px; padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .code { background-color: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>服务记录模块测试</h1>
        
        <div class="test-section">
            <div class="test-title">1. 后端API连接测试</div>
            <button onclick="testBackendConnection()">测试后端连接</button>
            <div id="backend-result" class="test-result pending">等待测试...</div>
        </div>

        <div class="test-section">
            <div class="test-title">2. 服务记录列表API测试</div>
            <button onclick="testGetServiceRecords()">获取服务记录列表</button>
            <div id="list-result" class="test-result pending">等待测试...</div>
        </div>

        <div class="test-section">
            <div class="test-title">3. 创建服务记录API测试</div>
            <button onclick="testCreateServiceRecord()">创建测试记录</button>
            <div id="create-result" class="test-result pending">等待测试...</div>
        </div>

        <div class="test-section">
            <div class="test-title">4. 统计数据API测试</div>
            <button onclick="testStatistics()">获取统计数据</button>
            <div id="stats-result" class="test-result pending">等待测试...</div>
        </div>

        <div class="test-section">
            <div class="test-title">5. 功能检查清单</div>
            <div class="code">
                <strong>已实现的功能：</strong><br>
                ✅ 服务记录数据模型 (ServiceRecord.java)<br>
                ✅ 数据传输对象 (ServiceRecordDTO.java)<br>
                ✅ 实体映射器 (ServiceRecordMapper.java)<br>
                ✅ 数据访问层 (ServiceRecordDao.java + XML映射)<br>
                ✅ 业务服务层 (ServiceRecordService + Impl)<br>
                ✅ REST控制器 (ServiceRecordController.java)<br>
                ✅ 前端API服务 (serviceRecord.js)<br>
                ✅ 前端主页面 (ServiceRecordList.vue)<br>
                ✅ 前端对话框组件 (ServiceRecordDialog.vue)<br>
                ✅ 前端评价组件 (EvaluationDialog.vue)<br>
                ✅ 路由配置 (index.js)<br><br>
                
                <strong>主要功能点：</strong><br>
                • 服务记录列表展示 (支持分页、搜索)<br>
                • 服务记录增删改查操作<br>
                • 批量删除功能<br>
                • 服务评价功能<br>
                • 状态统计展示<br>
                • 按老人查询服务记录<br>
                • 多条件搜索 (姓名、内容、提供者、状态、时间范围)<br>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8081/api';

        async function testBackendConnection() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.textContent = '正在测试连接...';
            resultDiv.className = 'test-result pending';

            try {
                const response = await fetch(`${API_BASE}/service-records?pageNum=1&pageSize=1`);
                if (response.ok) {
                    resultDiv.textContent = '✅ 后端服务连接成功！';
                    resultDiv.className = 'test-result success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.textContent = `❌ 连接失败: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        }

        async function testGetServiceRecords() {
            const resultDiv = document.getElementById('list-result');
            resultDiv.textContent = '正在获取服务记录...';
            resultDiv.className = 'test-result pending';

            try {
                const response = await fetch(`${API_BASE}/service-records?pageNum=1&pageSize=10`);
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `✅ 获取成功！<br>总记录数: ${data.total}<br>当前页数据: ${data.list?.length || 0} 条`;
                    resultDiv.className = 'test-result success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.textContent = `❌ 获取失败: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        }

        async function testCreateServiceRecord() {
            const resultDiv = document.getElementById('create-result');
            resultDiv.textContent = '正在创建测试记录...';
            resultDiv.className = 'test-result pending';

            const testData = {
                elderlyId: 1,
                serviceContent: "健康检查服务",
                serviceTime: new Date().toISOString().slice(0, 19),
                serviceAddress: "测试地址123号",
                serviceProviderType: "机构员工",
                serviceProviderName: "张护士",
                workOrderPrice: 50.00,
                status: "待处理"
            };

            try {
                const response = await fetch(`${API_BASE}/service-records`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `✅ 创建成功！<br>记录ID: ${data.id}<br>老人: ${data.elderlyName}<br>服务内容: ${data.serviceContent}`;
                    resultDiv.className = 'test-result success';
                } else {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
            } catch (error) {
                resultDiv.textContent = `❌ 创建失败: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        }

        async function testStatistics() {
            const resultDiv = document.getElementById('stats-result');
            resultDiv.textContent = '正在获取统计数据...';
            resultDiv.className = 'test-result pending';

            try {
                const [statusResponse, providerResponse] = await Promise.all([
                    fetch(`${API_BASE}/service-records/status-statistics`),
                    fetch(`${API_BASE}/service-records/provider-type-statistics`)
                ]);

                if (statusResponse.ok && providerResponse.ok) {
                    const statusData = await statusResponse.json();
                    const providerData = await providerResponse.json();
                    
                    let statusHtml = '<strong>状态统计:</strong><br>';
                    Object.entries(statusData).forEach(([key, value]) => {
                        statusHtml += `${key}: ${value} 条<br>`;
                    });
                    
                    let providerHtml = '<strong>服务提供者类型统计:</strong><br>';
                    Object.entries(providerData).forEach(([key, value]) => {
                        providerHtml += `${key}: ${value} 条<br>`;
                    });

                    resultDiv.innerHTML = `✅ 获取成功！<br>${statusHtml}<br>${providerHtml}`;
                    resultDiv.className = 'test-result success';
                } else {
                    throw new Error('统计API请求失败');
                }
            } catch (error) {
                resultDiv.textContent = `❌ 获取失败: ${error.message}`;
                resultDiv.className = 'test-result error';
            }
        }

        // 页面加载时自动测试连接
        window.onload = function() {
            setTimeout(testBackendConnection, 1000);
        };
    </script>
</body>
</html> 