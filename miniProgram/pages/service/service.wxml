<!--pages/service/service.wxml-->
<view class="service-container">
  <!-- 搜索栏 -->
  <view class="search-section">
    <view class="search-box">
      <icon class="search-icon" type="search" size="16" color="#999"></icon>
      <input class="search-input" placeholder="搜索机构名称或地址" bindinput="onSearchInput" value="{{searchKeyword}}" />
      <view class="search-btn" bindtap="onSearch">搜索</view>
    </view>
  </view>

  <!-- 筛选标签 -->
  <view class="filter-section">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-item {{currentFilter === '' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="">
        全部
      </view>
      <view class="filter-item {{currentFilter === '机构养老单位' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="机构养老单位">
        机构
      </view>
      <view class="filter-item {{currentFilter === '社区养老单位' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="社区养老单位">
        社区
      </view>
      <view class="filter-item {{currentFilter === '居家养老单位' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="居家养老单位">
        居家
      </view>
    </scroll-view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-section" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">正在加载机构信息...</text>
  </view>

  <!-- 机构列表 -->
  <view class="organization-list" wx:if="{{!loading}}">
    <view class="organization-card" wx:for="{{filteredOrganizations}}" wx:key="id" bindtap="onOrganizationTap" data-id="{{item.id}}">
      <!-- 机构头部信息 -->
      <view class="org-header">
        <view class="org-name">{{item.name}}</view>
        <view class="org-type">{{item.type}}</view>
      </view>

      <!-- 机构详细信息 -->
      <view class="org-details">
        <view class="detail-item">
          <icon class="detail-icon" type="success" size="14" color="#666"></icon>
          <text class="detail-text">{{item.phone}}</text>
        </view>
        <view class="detail-item" wx:if="{{item.email}}">
          <icon class="detail-icon" type="info" size="14" color="#666"></icon>
          <text class="detail-text">{{item.email}}</text>
        </view>
        <view class="detail-item">
          <icon class="detail-icon" type="warn" size="14" color="#666"></icon>
          <text class="detail-text">{{item.address}}</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="org-actions">
        <button class="action-btn archive-btn" catchtap="onArchiveTap" data-id="{{item.id}}">
          人员档案
        </button>
        <button class="action-btn staff-btn" catchtap="onServiceStaffTap" data-id="{{item.id}}" data-name="{{item.name}}">
          服务人员
        </button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && filteredOrganizations.length === 0}}">
    <image class="empty-icon" src="/images/service.png" mode="aspectFit"></image>
    <text class="empty-text">暂无相关机构信息</text>
    <button class="refresh-btn" bindtap="loadOrganizations">刷新重试</button>
  </view>

  <!-- 底部提示 -->
  <view class="footer-tip" wx:if="{{!loading && filteredOrganizations.length > 0}}">
    <text class="tip-text">已显示 {{filteredOrganizations.length}} 个机构</text>
  </view>
</view>