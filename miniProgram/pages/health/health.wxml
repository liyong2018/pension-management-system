<!-- 设备管理页面 -->
<view class="container">
  <!-- 搜索栏 -->
  <view class="search-section">
    <view class="search-bar">
      <t-icon name="search" size="32rpx" color="#999"></t-icon>
      <input 
        class="search-input" 
        placeholder="搜索设备名称、ID或类型"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
    </view>
  </view>

  <!-- 过滤标签 -->
  <view class="filter-section">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-tags">
        <text 
          class="filter-tag {{currentFilter === item.type ? 'active' : ''}}"
          wx:for="{{filterOptions}}"
          wx:key="type"
          bindtap="onFilterTap"
          data-type="{{item.type}}"
        >{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 设备列表 -->
  <view class="device-list" wx:else>
    <view 
      class="device-card"
      wx:for="{{filteredDevices}}"
      wx:key="id"
      bindtap="onDeviceTap"
      data-id="{{item.id}}"
      >
        <view class="device-header">
          <view class="device-info">
            <text class="device-name">{{item.deviceName}}</text>
            <view class="device-status {{item.status}}">
              <view class="status-dot"></view>
              <text class="status-text">{{item.status === 'online' ? '在线' : '离线'}}</text>
            </view>
          </view>
          <view class="device-type-badge">{{item.deviceType}}</view>
        </view>
        
        <view class="device-details">
          <view class="detail-item">
            <text class="detail-label">设备ID:</text>
            <text class="detail-value">{{item.deviceId}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">位置:</text>
            <text class="detail-value">{{item.location || '未设置'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">最后更新:</text>
            <text class="detail-value">{{item.lastUpdateTime || '未知'}}</text>
          </view>
          <view class="detail-item" wx:if="{{item.batteryLevel}}">
            <text class="detail-label">电量:</text>
            <text class="detail-value">{{item.batteryLevel}}%</text>
          </view>
        </view>
        
        <view class="device-actions">
          <view 
            class="action-btn secondary"
            bindtap="onDetailTap"
            data-id="{{item.id}}"
          >
            <t-icon name="view-list" size="28rpx"></t-icon>
            <text>详情</text>
          </view>
          
          <view 
            class="action-btn {{item.status === 'online' ? 'danger' : 'primary'}}"
            bindtap="{{item.status === 'online' ? 'onDisconnectTap' : 'onConnectTap'}}"
            data-id="{{item.id}}"
          >
            <t-icon name="{{item.status === 'online' ? 'close' : 'check'}}" size="28rpx"></t-icon>
            <text>{{item.status === 'online' ? '断开' : '连接'}}</text>
          </view>
        </view>
      </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && filteredDevices.length === 0}}">
    <t-icon name="device" size="120rpx" color="#E0E0E0"></t-icon>
    <text class="empty-title">暂无设备</text>
    <text class="empty-desc">{{searchKeyword || currentFilter !== 'all' ? '没有找到匹配的设备' : '还没有添加任何设备'}}</text>
    <view class="empty-action" wx:if="{{!searchKeyword && currentFilter === 'all'}}">
      <button class="connect-btn" bindtap="onConnectDevice">
        <t-icon name="add" size="32rpx"></t-icon>
        <text>添加设备</text>
      </button>
    </view>
  </view>

  <!-- 底部提示 -->
  <view class="footer-tips" wx:if="{{!loading && filteredDevices.length > 0}}">
    <text class="tips-text">共找到 {{filteredDevices.length}} 台设备</text>
  </view>
</view>

<!-- 加载状态 -->
<view class="loading" wx:if="{{loading}}">
  <text>加载中...</text>
</view>