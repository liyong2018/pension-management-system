<!-- 设备连接页面 -->
<view class="container">
  <!-- 搜索和筛选 -->
  <view class="search-section">
    <view class="search-bar">
      <t-input
        placeholder="搜索设备名称或编号"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
        clearable
        bindclear="onClearSearch"
      >
        <t-icon slot="suffix-icon" name="search" size="32rpx" color="#999" bindtap="onSearch"></t-icon>
      </t-input>
    </view>
    
    <view class="filter-bar">
      <picker 
        range="{{statusOptions}}" 
        range-key="label" 
        value="{{statusFilter}}"
        bindchange="onStatusFilterChange"
      >
        <view class="filter-item">
          <text>状态筛选</text>
          <t-icon name="chevron-down" size="24rpx"></t-icon>
        </view>
      </picker>
      
      <picker 
        range="{{typeOptions}}" 
        range-key="label" 
        value="{{typeFilter}}"
        bindchange="onTypeFilterChange"
      >
        <view class="filter-item">
          <text>类型筛选</text>
          <t-icon name="chevron-down" size="24rpx"></t-icon>
        </view>
      </picker>
    </view>
  </view>

  <!-- 设备列表 -->
  <view class="device-list" wx:if="{{!loading && devices.length > 0}}">
    <view 
      class="device-item"
      wx:for="{{devices}}"
      wx:key="id"
      bindtap="viewDeviceDetail"
      data-id="{{item.id}}"
    >
      <view class="device-info">
        <view class="device-header">
          <text class="device-name">{{item.deviceName}}</text>
          <view class="device-status {{item.status}}">
            <view class="status-dot"></view>
            <text class="status-text">{{item.statusText}}</text>
          </view>
        </view>
        
        <view class="device-details">
          <text class="device-type">{{item.deviceType}}</text>
          <text class="device-location">{{item.location || '未设置位置'}}</text>
        </view>
        
        <view class="device-meta">
          <text class="device-id">设备编号: {{item.deviceId}}</text>
          <text class="last-update">最后更新: {{item.lastUpdateTime}}</text>
        </view>
      </view>
      
      <view class="device-actions" catchtap="stopPropagation">
        <button 
          wx:if="{{item.status === 'offline'}}"
          class="action-btn connect-btn"
          size="mini"
          bindtap="connectDevice"
          data-id="{{item.id}}"
        >
          连接
        </button>
        
        <button 
          wx:if="{{item.status === 'online'}}"
          class="action-btn disconnect-btn"
          size="mini"
          bindtap="disconnectDevice"
          data-id="{{item.id}}"
        >
          断开
        </button>
        
        <button 
          wx:if="{{item.status === 'alarm'}}"
          class="action-btn alarm-btn"
          size="mini"
          bindtap="viewDeviceDetail"
          data-id="{{item.id}}"
        >
          查看告警
        </button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && devices.length === 0}}">
    <t-icon name="device" size="120rpx" color="#DDD"></t-icon>
    <text class="empty-text">暂无设备数据</text>
    <button class="refresh-btn" bindtap="refreshDevices">刷新</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{loading}}">
    <t-loading theme="circular" size="60rpx"></t-loading>
    <text class="loading-text">加载中...</text>
  </view>
</view>